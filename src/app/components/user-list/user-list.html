<p-table 
    #dt
    [value]="listUsers()"
    [rows]="thePageSize"                 [paginator]="true"
    [totalRecords]="theTotalElements"
    [lazy]="true"
    (onLazyLoad)="onPageChange($event)"
[globalFilterFields]="['matricule', 'firstName', 'position', 'isActivated', 'note', 'grade']"    [rowHover]="true"
    dataKey="matricule"
    [(selection)]="selectedUsers"
    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} users"
    [showCurrentPageReport]="true"
    [rowsPerPageOptions]="[10, 20, 30]" [columns]="cols"
    [tableStyle]="{ 'min-width': '75rem' }"
>
    <ng-template pTemplate="caption">
        <div class="flex items-center justify-between">
            <h5 class="m-0">User Management</h5>
            <p-iconfield>
                <p-inputicon styleClass="pi pi-search" />
                <input pInputText type="text" (input)="onGlobalFilter(dt, $event)" placeholder="Rechercher..." />
            </p-iconfield>
        </div>
    </ng-template>
    
    <ng-template pTemplate="header">
        <tr>
            <th style="width: 3rem;">
                <p-tableHeaderCheckbox />
            </th>
            <th style="min-width: 16rem" pSortableColumn="matricule">
                Matricule
                <p-sortIcon field="matricule" />
            </th>
            <th pSortableColumn="firstName">
                Nom & Prénom
                <p-sortIcon field="firstName" />
            </th>
            
            <th pSortableColumn="position" style="min-width: 8rem">
                Position
                <p-sortIcon field="position" />
            </th>

            <th pSortableColumn="isActivated" style="min-width: 10rem;" class="text-center">
                Actif
                <p-sortIcon field="isActivated" />
            </th>
             <th pSortableColumn="note" style="min-width: 12rem">
            Note
            <p-sortIcon field="note" />
        </th>
            <th pSortableColumn="grade" style="min-width: 12rem">
                Grade
                <p-sortIcon field="grade" />
            </th>
            <th style="min-width: 8rem;"></th>
        </tr>
        
        <tr>
            <th></th> 
            
                <th>
<p-columnFilter type="text" field="matricule" matchMode="contains" placeholder="Filtrer par matricule" ariaLabel="Filter Matricule" />
</th>                
    <th>
    <p-columnFilter field="firstName" matchMode="in" [showMenu]="false">
        <ng-template pTemplate="filter" let-value let-filter="filterCallback">
            <p-multiSelect 
                [ngModel]="value" 
                [options]="availableFirstNames" placeholder="Filtrer par nom" 
                (onChange)="filter($event.value)" 
                optionLabel="fullName" > 
                
                <ng-template let-option pTemplate="item">
                    <div class="inline-block vertical-align-middle flex items-center">
                        <img 
                            [alt]="option.firstName" 
                            [src]="option.photoUrl || 'assets/images/default-profile.png'" 
                            width="24" 
                            height="24"
                            class="vertical-align-middle mr-2"
                            style="border-radius: 50%; object-fit: cover;" />
                        <span class="ml-1">{{ option.firstName }} {{ option.lastName }}</span> 
                    </div>
                </ng-template>
                
                <ng-template let-value pTemplate="selectedItems">
                    <ng-container *ngIf="value && value.length > 0">
                        {{ value.length }} items selected 
                    </ng-container>
                    <ng-container *ngIf="!value || value.length === 0">
                        Filtrer par nom
                    </ng-container>
                </ng-template>

            </p-multiSelect>
        </ng-template>
    </p-columnFilter>
</th>
          
            
            <th>
               <p-columnFilter field="position" matchMode="equals" [showMenu]="false">
        <ng-template pTemplate="filter" let-value let-filter="filterCallback">
            <p-select 
                [ngModel]="value" 
                [options]="availablePositions" 
                (onChange)="filter($event.value)" 
                placeholder="Tous les postes" 
                optionLabel="label" 
                optionValue="value"
                [showClear]="true"
            />
        </ng-template>
    </p-columnFilter>
            </th>
            
            <th>
                <p-columnFilter type="boolean" field="isActivated" />
            </th>
            
            <th><p-columnFilter field="note" matchMode="gte" [showMenu]="false">
        <ng-template pTemplate="filter" let-value let-filter="filterCallback">
            <div class="flex flex-col gap-2 p-2 align-items-center">
                
                <p-rating 
                    [ngModel]="value || 0" 
                    (ngModelChange)="filter($event)" 
                    [stars]="5" 
                    
                    class="my-2"
                />
                
                
            </div>
        </ng-template>
    </p-columnFilter></th> 
            
            <th>
                <p-columnFilter field="grade" matchMode="equals" [showMenu]="false">
                    <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                        <p-select 
                            [ngModel]="value" 
                            [options]="availableGrades" 
                            (onChange)="filter($event.value)" 
                            placeholder="Tous les grades" 
                            optionLabel="label" 
                            optionValue="value"
                            [showClear]="true"
                        />
                    </ng-template>
                </p-columnFilter>
            </th> 
            
            <th></th> 
        </tr>
    </ng-template>

    <ng-template pTemplate="body" let-user>
        <tr>
            <td style="width: 3rem; ">
                <p-tableCheckbox [value]="user" />
            </td>
            <td style="min-width: 12rem">{{ user.matricule }}</td>
            
            <td style="min-width: 18rem">
                <div class="flex items-center">
                    <img 
                        [alt]="user.firstName" 
                        [src]="user.photoUrl || 'assets/images/default-profile.png'" 
                        width="32" 
                        height="32" 
                        class="mr-2"
                        style="border-radius: 50%; object-fit: cover;" 
                    />
                    <span>
                        {{ user.firstName }} {{ user.lastName }}
                    </span>
                </div>
            </td>
            
            <td>{{ user.position }}</td>

            <td class="text-center">
                <i 
                    class="pi" 
                    [ngClass]="{ 
                        'text-green-500 pi-check-circle': user.isActivated, 
                        'text-red-500 pi-times-circle': !user.isActivated 
                    }"
                ></i>
            </td>
            
            <td>
                <p-rating [ngModel]="user.note" [readonly]="true" /> 
            </td>
            
            <td>
                <p-tag [value]="user.grade" [severity]="getGrade(user.grade)" />
            </td>
            
            <td>
                <!-- <p-button icon="pi pi-pencil" [rounded]="true" [outlined]="true" (click)="editUser(user)" pTooltip="Edit" tooltipPosition="top" />
                <p-button icon="pi pi-trash" severity="danger" [rounded]="true" [outlined]="true" (click)="deleteUser(user)" pTooltip="Delete" tooltipPosition="top" />
          -->   </td>
        </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
        <tr>
            <td [attr.colspan]="9">No users found.</td> 
        </tr>
    </ng-template>

</p-table>
